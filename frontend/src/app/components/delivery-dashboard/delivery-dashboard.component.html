<div class="min-h-screen bg-gradient-to-br from-gray-50 to-gray-100">
  <!-- Modern Header -->
  <nav class="bg-gradient-to-r from-slate-700 to-slate-800 shadow-lg sticky top-0 z-50">
    <div class="flex items-center justify-between h-14 px-4">
      <!-- Left: Logo -->
      <div class="flex items-center gap-2">
        <div class="w-8 h-8 bg-white rounded-lg flex items-center justify-center shadow-lg">
          <mat-icon class="!text-slate-700 !text-xl">local_shipping</mat-icon>
        </div>
        <span class="text-white font-bold text-lg hidden sm:block">DIVery</span>
      </div>

      <!-- Right: Actions + Profile -->
      <div class="flex items-center gap-1">
        <button 
          mat-icon-button 
          (click)="refreshData()"
          class="!text-white hover:!bg-white/10 !transition-all"
          matTooltip="Refresh">
          <mat-icon>refresh</mat-icon>
        </button>
        
        <button 
          mat-icon-button 
          [matMenuTriggerFor]="profileMenu"
          class="!text-white hover:!bg-white/10 !transition-all"
          matTooltip="Account Menu">
          <mat-icon>account_circle</mat-icon>
        </button>
      </div>

      <!-- Profile Menu -->
      <mat-menu #profileMenu="matMenu" class="profile-menu">
        <button mat-menu-item (click)="openAccountSettings()" class="!h-12">
          <mat-icon class="!text-gray-600">settings</mat-icon>
          <span>Account Settings</span>
        </button>
        <mat-divider></mat-divider>
        <button mat-menu-item (click)="logout()" class="!h-12">
          <mat-icon class="!text-red-600">logout</mat-icon>
          <span class="text-red-600">Logout</span>
        </button>
      </mat-menu>
    </div>
  </nav>

  <!-- Loading State -->
  <div *ngIf="loading" class="flex items-center justify-center min-h-[400px]">
    <div class="text-center">
      <div class="inline-flex items-center justify-center w-16 h-16 bg-indigo-100 rounded-full mb-4">
        <mat-icon class="!text-indigo-600 !text-4xl animate-spin">refresh</mat-icon>
      </div>
      <p class="text-gray-600 font-medium">Loading delivery data...</p>
    </div>
  </div>

  <!-- Dashboard Content -->
  <div *ngIf="!loading" class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8 space-y-6">
    
    <!-- KPI Cards -->
    <section>
      <h2 class="text-xl font-semibold text-gray-900 mb-4 flex items-center gap-2">
        <mat-icon class="!text-gray-600">analytics</mat-icon>
        Overview
      </h2>
      <div class="grid grid-cols-2 md:grid-cols-4 gap-3">
        
        <!-- Today's Deliveries -->
        <div class="bg-white rounded-lg shadow-sm hover:shadow-md transition-all p-3 border border-gray-100">
          <p class="text-xs font-semibold text-blue-600 mb-1">Today's Deliveries</p>
          <p class="text-xl font-bold text-blue-600">{{ todaysDeliveries.length }}</p>
        </div>

        <!-- Pending -->
        <div class="bg-white rounded-lg shadow-sm hover:shadow-md transition-all p-3 border border-gray-100">
          <p class="text-xs font-semibold text-yellow-600 mb-1">Pending</p>
          <p class="text-xl font-bold text-yellow-600">{{ pendingDeliveries.length }}</p>
        </div>

        <!-- Completed -->
        <div class="bg-white rounded-lg shadow-sm hover:shadow-md transition-all p-3 border border-gray-100">
          <p class="text-xs font-semibold text-green-600 mb-1">Completed</p>
          <p class="text-xl font-bold text-green-600">{{ deliveredDeliveries.length }}</p>
        </div>

        <!-- Overdue -->
        <div class="bg-white rounded-lg shadow-sm hover:shadow-md transition-all p-3 border border-gray-100">
          <p class="text-xs font-semibold text-red-600 mb-1">Overdue</p>
          <p class="text-xl font-bold text-red-600">{{ getOverdueCount() }}</p>
        </div>

      </div>
    </section>

    <!-- Filters Section -->
    <div class="bg-white rounded-2xl shadow-card p-6 border border-gray-100">
      <div class="mb-4">
        <h3 class="text-lg font-semibold text-gray-900 flex items-center gap-2">
          <mat-icon class="!text-gray-600">filter_list</mat-icon>
          Search & Filters
        </h3>
        <p class="text-sm text-gray-600 mt-1">Filter deliveries by status and priority</p>
      </div>

      <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
        <app-modern-input
          [(ngModel)]="searchTerm"
          (valueChange)="applyFilters()"
          placeholder="Search by ID, customer..."
          prefixIcon="search"
          [clearable]="true">
        </app-modern-input>

        <select 
          class="px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-primary-500 focus:border-transparent transition-all text-gray-900 bg-white"
          [(ngModel)]="selectedStatus" 
          (change)="applyFilters()">
          <option value="">All Statuses</option>
          <option value="PENDING">Pending</option>
          <option value="IN_TRANSIT">In Transit</option>
          <option value="DELIVERED">Delivered</option>
          <option value="DOOR_LOCKED">Door Locked</option>
          <option value="DAMAGED_IN_TRANSIT">Damaged</option>
          <option value="RETURNED">Returned</option>
        </select>

        <select 
          class="px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-primary-500 focus:border-transparent transition-all text-gray-900 bg-white"
          [(ngModel)]="selectedPriority" 
          (change)="applyFilters()">
          <option value="">All Priorities</option>
          <option value="EMERGENCY">ðŸš¨ Emergency</option>
          <option value="PERISHABLE">ðŸ¥› Perishable</option>
          <option value="ESSENTIAL">âš¡ Essential</option>
          <option value="STANDARD">ðŸ“¦ Standard</option>
          <option value="LOW">ðŸ“‹ Low Priority</option>
        </select>
      </div>
    </div>

    <!-- Delivery Tabs -->
    <div class="bg-white rounded-2xl shadow-card border border-gray-100 overflow-hidden">
      <mat-tab-group class="modern-tabs" (selectedTabChange)="onTabChange($event)">
        
        <!-- Today's Deliveries Tab -->
        <mat-tab>
          <ng-template mat-tab-label>
            <div class="flex items-center gap-2">
              <mat-icon>today</mat-icon>
              <span>Today's Deliveries</span>
              <span *ngIf="getFilteredTodaysDeliveries().length > 0" 
                    class="ml-2 px-2 py-0.5 bg-blue-100 text-blue-700 text-xs font-semibold rounded-full">
                {{ getFilteredTodaysDeliveries().length }}
              </span>
            </div>
          </ng-template>

          <div class="p-6">
            <!-- Empty State -->
            <div *ngIf="getFilteredTodaysDeliveries().length === 0" class="text-center py-16">
              <div class="inline-flex items-center justify-center w-16 h-16 bg-blue-100 rounded-full mb-4">
                <mat-icon class="!text-blue-600 !text-4xl">today</mat-icon>
              </div>
              <h4 class="text-lg font-semibold text-gray-900 mb-2">No deliveries for today</h4>
              <p class="text-gray-600">All caught up! Check pending deliveries or come back tomorrow.</p>
            </div>

            <!-- Delivery Grid -->
            <div *ngIf="getFilteredTodaysDeliveries().length > 0" class="grid grid-cols-1 gap-4">
              <div *ngFor="let delivery of getFilteredTodaysDeliveries()">
                <app-delivery-card
                  [delivery]="delivery"
                  (statusUpdate)="onDeliveryUpdate($event)"
                  (viewDetails)="onViewDetails($event)">
                </app-delivery-card>
              </div>
            </div>
          </div>
        </mat-tab>

        <!-- Pending Deliveries Tab -->
        <mat-tab>
          <ng-template mat-tab-label>
            <div class="flex items-center gap-2">
              <mat-icon>schedule</mat-icon>
              <span>Pending</span>
              <span *ngIf="getFilteredPendingDeliveries().length > 0" 
                    class="ml-2 px-2 py-0.5 bg-yellow-100 text-yellow-700 text-xs font-semibold rounded-full">
                {{ getFilteredPendingDeliveries().length }}
              </span>
            </div>
          </ng-template>

          <div class="p-6">
            <!-- Empty State -->
            <div *ngIf="getFilteredPendingDeliveries().length === 0" class="text-center py-16">
              <div class="inline-flex items-center justify-center w-16 h-16 bg-green-100 rounded-full mb-4">
                <mat-icon class="!text-green-600 !text-4xl">done_all</mat-icon>
              </div>
              <h4 class="text-lg font-semibold text-gray-900 mb-2">All caught up!</h4>
              <p class="text-gray-600">No pending deliveries. Great work!</p>
            </div>

            <!-- Delivery Grid -->
            <div *ngIf="getFilteredPendingDeliveries().length > 0" class="grid grid-cols-1 gap-4">
              <div *ngFor="let delivery of getFilteredPendingDeliveries()">
                <app-delivery-card
                  [delivery]="delivery"
                  (statusUpdate)="onDeliveryUpdate($event)"
                  (viewDetails)="onViewDetails($event)">
                </app-delivery-card>
              </div>
            </div>
          </div>
        </mat-tab>

        <!-- Completed Tab -->
        <mat-tab>
          <ng-template mat-tab-label>
            <div class="flex items-center gap-2">
              <mat-icon>check_circle</mat-icon>
              <span>Completed</span>
              <span *ngIf="getFilteredDeliveredDeliveries().length > 0" 
                    class="ml-2 px-2 py-0.5 bg-green-100 text-green-700 text-xs font-semibold rounded-full">
                {{ getFilteredDeliveredDeliveries().length }}
              </span>
            </div>
          </ng-template>

          <div class="p-6">

            <!-- Empty State -->
            <div *ngIf="getFilteredDeliveredDeliveries().length === 0" class="text-center py-16">
              <div class="inline-flex items-center justify-center w-16 h-16 bg-gray-100 rounded-full mb-4">
                <mat-icon class="!text-gray-400 !text-4xl">check_circle</mat-icon>
              </div>
              <h4 class="text-lg font-semibold text-gray-900 mb-2">No completed deliveries yet</h4>
              <p class="text-gray-600">Completed deliveries (delivered, returned, or with issues) will appear here.</p>
            </div>

            <!-- Delivery Grid -->
            <div *ngIf="getFilteredDeliveredDeliveries().length > 0" class="grid grid-cols-1 gap-4">
              <div *ngFor="let delivery of getFilteredDeliveredDeliveries()">
                <app-delivery-card
                  [delivery]="delivery"
                  [isDelivered]="true"
                  (viewDetails)="onViewDetails($event)">
                </app-delivery-card>
              </div>
            </div>
          </div>
        </mat-tab>

      </mat-tab-group>
    </div>
  </div>
</div>
