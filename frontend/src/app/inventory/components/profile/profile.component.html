<div class="profile-container">
  <mat-card class="profile-card">
    <mat-card-header>
      <mat-card-title>
        <mat-icon>person</mat-icon>
        My Profile
      </mat-card-title>
    </mat-card-header>

    <mat-card-content>
      <!-- Profile Information Section -->
      <div class="section">
        <div class="section-header">
          <h3>Profile Information</h3>
          <button 
            mat-raised-button 
            color="primary" 
            (click)="toggleEditProfile()"
            *ngIf="!isEditingProfile">
            <mat-icon>edit</mat-icon>
            Edit Profile
          </button>
        </div>

        <form [formGroup]="profileForm" *ngIf="profile">
          <mat-form-field appearance="outline" class="full-width">
            <mat-label>Username</mat-label>
            <input matInput [value]="profile.username" readonly>
            <mat-icon matPrefix>account_circle</mat-icon>
          </mat-form-field>

          <mat-form-field appearance="outline" class="full-width">
            <mat-label>Full Name</mat-label>
            <input 
              matInput 
              formControlName="fullName" 
              [readonly]="!isEditingProfile">
            <mat-icon matPrefix>badge</mat-icon>
            <mat-error *ngIf="profileForm.get('fullName')?.hasError('required')">
              Full name is required
            </mat-error>
            <mat-error *ngIf="profileForm.get('fullName')?.hasError('minlength')">
              Full name must be at least 2 characters
            </mat-error>
          </mat-form-field>

          <mat-form-field appearance="outline" class="full-width">
            <mat-label>Email</mat-label>
            <input 
              matInput 
              type="email" 
              formControlName="email" 
              [readonly]="!isEditingProfile">
            <mat-icon matPrefix>email</mat-icon>
            <mat-error *ngIf="profileForm.get('email')?.hasError('email')">
              Invalid email format
            </mat-error>
          </mat-form-field>

          <div class="action-buttons" *ngIf="isEditingProfile">
            <button 
              mat-raised-button 
              color="primary" 
              (click)="saveProfile()"
              [disabled]="!profileForm.valid || loading">
              <mat-icon>save</mat-icon>
              Save Changes
            </button>
            <button 
              mat-button 
              (click)="toggleEditProfile()"
              [disabled]="loading">
              Cancel
            </button>
          </div>
        </form>
      </div>

      <mat-divider></mat-divider>

      <!-- Account Details Section -->
      <div class="section" *ngIf="profile">
        <h3>Account Details</h3>
        <div class="info-grid">
          <div class="info-item">
            <mat-icon class="info-icon">schedule</mat-icon>
            <div class="info-content">
              <span class="label">Last Login</span>
              <span class="value">{{ formatDate(profile.lastLoginAt) }}</span>
            </div>
          </div>
        </div>
      </div>

      <mat-divider></mat-divider>

      <!-- Change Password Section -->
      <div class="section">
        <div class="section-header">
          <h3>Security</h3>
          <button 
            mat-raised-button 
            color="accent" 
            (click)="toggleChangePassword()"
            *ngIf="!isChangingPassword">
            <mat-icon>lock</mat-icon>
            Change Password
          </button>
        </div>

        <form [formGroup]="passwordForm" *ngIf="isChangingPassword">
          <mat-form-field appearance="outline" class="full-width">
            <mat-label>Current Password</mat-label>
            <input 
              matInput 
              type="password" 
              formControlName="currentPassword">
            <mat-icon matPrefix>lock_open</mat-icon>
            <mat-error *ngIf="passwordForm.get('currentPassword')?.hasError('required')">
              Current password is required
            </mat-error>
          </mat-form-field>

          <mat-form-field appearance="outline" class="full-width">
            <mat-label>New Password</mat-label>
            <input 
              matInput 
              type="password" 
              formControlName="newPassword">
            <mat-icon matPrefix>lock</mat-icon>
            <mat-error *ngIf="passwordForm.get('newPassword')?.hasError('required')">
              New password is required
            </mat-error>
            <mat-error *ngIf="passwordForm.get('newPassword')?.hasError('minlength')">
              Password must be at least 8 characters
            </mat-error>
          </mat-form-field>

          <div class="password-hint">
            <mat-icon>info</mat-icon>
            <div class="hint-content">
              <strong>Password Requirements:</strong>
              <ul>
                <li>At least 8 characters long</li>
                <li>One uppercase letter (A-Z)</li>
                <li>One lowercase letter (a-z)</li>
                <li>One digit (0-9)</li>
                <li>One special character (!@#$%^&*)</li>
              </ul>
            </div>
          </div>

          <div class="action-buttons">
            <button 
              mat-raised-button 
              color="accent" 
              (click)="changePassword()"
              [disabled]="!passwordForm.valid || loading">
              <mat-icon>check</mat-icon>
              Update Password
            </button>
            <button 
              mat-button 
              (click)="toggleChangePassword()"
              [disabled]="loading">
              Cancel
            </button>
          </div>
        </form>
      </div>
    </mat-card-content>
  </mat-card>
</div>
