<div class="dashboard-container">
  <!-- Header Section -->
  <div class="dashboard-header">
    <div class="header-content">
      <div class="header-text">
        <h1 class="dashboard-title">Inventory Dashboard</h1>
        <p class="dashboard-subtitle">Monitor your inventory and delivery operations</p>
      </div>
      <div class="header-actions">
        <button mat-fab color="primary" routerLink="/inventory/products" matTooltip="Add Product">
          <mat-icon>add</mat-icon>
        </button>
      </div>
    </div>
  </div>

  <!-- Loading State -->
  <div *ngIf="loading" class="loading-container">
    <div class="loading-spinner">
      <mat-icon class="spin">refresh</mat-icon>
    </div>
    <p class="loading-text">Loading dashboard data...</p>
  </div>

  <!-- Dashboard Content -->
  <div *ngIf="!loading" class="dashboard-content">
    
    <!-- Key Performance Indicators -->
    <section class="kpi-section">
      <h2 class="section-title">Overview</h2>
      <div class="kpi-grid">
        
        <!-- Total Products Card -->
        <div class="kpi-card total-products">
          <div class="kpi-header">
            <div class="kpi-title">
              <mat-icon>inventory_2</mat-icon>
              <span>Total Products</span>
            </div>
          </div>
          <div class="kpi-main">
            <div class="kpi-value">{{ calculateTotalProducts() }}</div>
            <div class="kpi-subtitle">Active inventory items</div>
          </div>
        </div>

        <!-- Total Value Card -->
        <div class="kpi-card total-value">
          <div class="kpi-header">
            <div class="kpi-title">
              <mat-icon>attach_money</mat-icon>
              <span>Total Value</span>
            </div>
          </div>
          <div class="kpi-main">
            <div class="kpi-value">₹{{ calculateTotalValue() | number:'1.2-2' }}</div>
            <div class="kpi-subtitle">Current inventory value</div>
          </div>
        </div>

        <!-- Damaged Items Card -->
        <div class="kpi-card damaged-items">
          <div class="kpi-header">
            <div class="kpi-title">
              <mat-icon>warning</mat-icon>
              <span>Damaged Items</span>
            </div>
          </div>
          <div class="kpi-main">
            <div class="kpi-value damaged">{{ calculateDamagedProducts() }}</div>
            <div class="kpi-subtitle">Require attention</div>
          </div>
        </div>

        <!-- Expiring Soon Card -->
        <div class="kpi-card expiring-soon">
          <div class="kpi-header">
            <div class="kpi-title">
              <mat-icon>schedule</mat-icon>
              <span>Expiring Soon</span>
            </div>
          </div>
          <div class="kpi-main">
            <div class="kpi-value warning">{{ calculateExpiringProducts() }}</div>
            <div class="kpi-subtitle">Within 7 days</div>
          </div>
        </div>

        <!-- Pending Deliveries Card -->
        <div class="kpi-card pending-deliveries">
          <div class="kpi-header">
            <div class="kpi-title">
              <mat-icon>local_shipping</mat-icon>
              <span>Pending Deliveries</span>
            </div>
          </div>
          <div class="kpi-main">
            <div class="kpi-value pending">{{ calculatePendingDeliveries() }}</div>
            <div class="kpi-subtitle">Awaiting dispatch</div>
          </div>
        </div>

        <!-- Successful Deliveries Card -->
        <div class="kpi-card successful-deliveries">
          <div class="kpi-header">
            <div class="kpi-title">
              <mat-icon>check_circle</mat-icon>
              <span>Successful Deliveries</span>
            </div>
          </div>
          <div class="kpi-main">
            <div class="kpi-value success">{{ calculateSuccessfulDeliveries() }}</div>
            <div class="kpi-subtitle">Successfully delivered</div>
          </div>
        </div>

      </div>
    </section>

    <!-- Inventory Search & Filters -->
    <section class="search-section">
      <div class="search-card">
        <div class="search-header">
          <h3 class="search-title">Inventory Search & Filters</h3>
          <p class="search-subtitle">Find and filter your inventory items</p>
        </div>
        <div class="search-controls">
          <div class="search-input-group">
            <mat-icon class="search-icon">search</mat-icon>
            <input type="text" 
                   class="search-input" 
                   placeholder="Search by product name, SKU, or category..."
                   [(ngModel)]="searchTerm"
                   (input)="onSearchChange()">
            <button *ngIf="searchTerm" 
                    class="clear-search-btn" 
                    (click)="searchTerm = ''; onSearchChange()"
                    matTooltip="Clear search">
              <mat-icon>close</mat-icon>
            </button>
          </div>
          <div class="filter-group">
            <select class="filter-select" [(ngModel)]="selectedCategory" (change)="onCategoryChange()">
              <option value="">All Categories</option>
              <option *ngFor="let category of availableCategories" [value]="category">
                {{ category }}
              </option>
            </select>
            <select class="filter-select" [(ngModel)]="selectedStatus" (change)="onStatusChange()">
              <option value="">All Status</option>
              <option value="good">Good</option>
              <option value="damaged">Damaged / Out of Stock</option>
              <option value="expiring">Expiring Soon</option>
            </select>
            <button class="clear-filters-btn" 
                    (click)="clearFilters()"
                    [disabled]="!searchTerm && !selectedCategory && !selectedStatus"
                    matTooltip="Clear all filters">
              <mat-icon>filter_list_off</mat-icon>
              Clear Filters
            </button>
          </div>
        </div>
      </div>
    </section>

    <!-- Current Inventory Table -->
    <section class="inventory-table-section">
      <div class="inventory-table-card">
        <div class="table-header">
          <h3 class="table-title">Current Inventory</h3>
          <p class="table-subtitle">
            Showing {{ getFilteredItemsCount() }} of {{ getTotalItemsCount() }} products
            <span *ngIf="searchTerm || selectedCategory || selectedStatus" class="filter-indicator">
              (filtered)
            </span>
          </p>
        </div>
        <div class="table-container">
          <div *ngIf="filteredInventoryItems.length === 0" class="no-results">
            <mat-icon>search_off</mat-icon>
            <h4>No products found</h4>
            <p>Try adjusting your search terms or filters</p>
            <button mat-button (click)="clearFilters()">Clear all filters</button>
          </div>
          <table *ngIf="filteredInventoryItems.length > 0" class="inventory-table">
            <thead>
              <tr>
                <th>SKU</th>
                <th>Product Name</th>
                <th>Category</th>
                <th>Quantity</th>
                <th>Location</th>
                <th>Status</th>
                <th>Expiry Date</th>
                <th>Unit Price</th>
                <th>Total</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let item of filteredInventoryItems" class="table-row">
                <td class="sku-cell">{{ item.sku }}</td>
                <td class="product-name">{{ item.name }}</td>
                <td class="category">{{ item.category }}</td>
                <td class="quantity" [class.low-stock]="item.quantity < 10" [class.out-of-stock]="item.quantity === 0">
                  {{ item.quantity }}
                </td>
                <td class="location">{{ item.location }}</td>
                <td class="status">
                  <span class="status-badge" [ngClass]="item.statusClass">
                    {{ item.status }}
                  </span>
                </td>
                <td class="expiry">{{ item.expiryDate || 'N/A' }}</td>
                <td class="price">₹{{ item.unitPrice | number:'1.2-2' }}</td>
                <td class="total">₹{{ getProductTotal(item) | number:'1.2-2' }}</td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </section>

    <!-- Analytics Section -->
    <section class="analytics-section">
      <div class="analytics-grid">
        
        <!-- Deliveries by Agent -->
        <mat-card class="analytics-card agent-chart" 
                  *ngIf="stats?.deliveriesByAgent && getObjectKeys(stats?.deliveriesByAgent || {}).length > 0">
          <mat-card-header>
            <mat-card-title>
              <mat-icon>person</mat-icon>
              Delivery Performance
            </mat-card-title>
          </mat-card-header>
          <mat-card-content>
            <div class="agent-list">
              <div *ngFor="let agent of getObjectKeys(stats?.deliveriesByAgent || {})" 
                   class="agent-item">
                <div class="agent-avatar">
                  <mat-icon>account_circle</mat-icon>
                </div>
                <div class="agent-info">
                  <div class="agent-name">{{ agent }}</div>
                  <div class="agent-deliveries">{{ stats?.deliveriesByAgent?.[agent] || 0 }} deliveries</div>
                </div>
                <div class="agent-rating">
                  <mat-icon class="star">star</mat-icon>
                  <span>4.8</span>
                </div>
              </div>
            </div>
          </mat-card-content>
        </mat-card>

      </div>
    </section>



  </div>
</div>